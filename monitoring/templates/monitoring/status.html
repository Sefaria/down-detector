{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sefaria Status - Service Health Monitoring</title>
    <meta name="description"
        content="Real-time status page for Sefaria services - Check the operational status of sefaria.org and related services.">

    <!-- Open Graph -->
    <meta property="og:title" content="Sefaria Status - Service Health Monitoring">
    <meta property="og:description" content="Real-time status of Sefaria services">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://status.sefaria.org">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'icons/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'icons/apple-touch-icon.png' %}">



    <link rel="stylesheet" href="{% static 'monitoring/style.css' %}">
</head>

<body>
    <div class="container">
        <!-- Header with Logo -->
        <header>
            <div class="header-main">
                <a href="https://www.sefaria.org" class="logo-link" target="_blank" rel="noopener">
                    <img src="{% static 'img/logo.svg' %}" alt="Sefaria" class="logo"
                        onerror="this.style.display='none'">
                </a>
                <h1>Status</h1>
            </div>
            <p class="subtitle">Real-time service health monitoring</p>
        </header>

        <!-- Overall Status Banner -->
        <section class="overall-status status-{{ overall_status }}">
            <div class="status-indicator">
                <span class="status-dot {% if overall_status != 'operational' %}pulse{% endif %}"></span>
            </div>
            <div class="status-info">
                <span class="status-text">{{ status_label }}</span>
                <span class="last-updated">Last checked: <time id="last-checked">just now</time></span>
            </div>
        </section>

        <!-- Service Status List -->
        <section class="services">
            <h2>Services</h2>
            <div class="service-list">
                {% for service in services %}
                <div class="service-item">
                    <div class="service-info">
                        <span class="service-dot status-{{ service.status }}"></span>
                        <span class="service-name">{{ service.name }}</span>
                    </div>
                    <div class="service-status">
                        {% if service.status == 'up' %}
                        <span class="status-badge status-up">Operational</span>
                        {% if service.response_time_ms %}
                        <span class="response-time">{{ service.response_time_ms }}ms</span>
                        {% endif %}
                        {% elif service.status == 'down' %}
                        <span class="status-badge status-down">Down</span>
                        {% if service.error_message %}
                        <span class="error-hint" title="{{ service.error_message }}">ⓘ</span>
                        {% endif %}
                        {% else %}
                        <span class="status-badge status-unknown">Unknown</span>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="no-services">No services configured.</p>
                {% endfor %}
            </div>
        </section>

        <!-- Active Incidents -->
        {% if active_incidents %}
        <section class="incidents active-incidents">
            <h2>Active Incidents</h2>
            {% for incident in active_incidents %}
            <div class="incident severity-{{ incident.severity }}">
                <div class="incident-header">
                    <span class="severity-badge">{{ incident.get_severity_display }}</span>
                    <div class="incident-times">
                        <time datetime="{{ incident.created_at|date:'c' }}">Created: {{ incident.created_at|date:"M j, Y
                            g:i A" }}</time>
                        {% if incident.updated_at != incident.created_at %}
                        <time datetime="{{ incident.updated_at|date:'c' }}" class="updated-time">Updated: {{
                            incident.updated_at|date:"M j, Y g:i A" }}</time>
                        {% endif %}
                    </div>
                </div>
                <p class="incident-text">{{ incident.text }}</p>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Incident History -->
        {% if resolved_incidents %}
        <section class="incidents resolved-incidents">
            <h2>Recent History</h2>
            {% for incident in resolved_incidents %}
            <div class="incident severity-resolved">
                <div class="incident-header">
                    <span class="severity-badge resolved">Resolved</span>
                    <div class="incident-times">
                        <time datetime="{{ incident.created_at|date:'c' }}">
                            Created: {{ incident.created_at|date:"M j, Y g:i A" }}
                        </time>
                        <time datetime="{{ incident.updated_at|date:'c' }}" class="updated-time">
                            Resolved: {{ incident.updated_at|date:"M j, Y g:i A" }}
                        </time>
                    </div>
                </div>
                <p class="incident-text">{{ incident.text }}</p>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <footer>
            <div class="footer-links">
                <a href="https://www.sefaria.org" target="_blank" rel="noopener">Sefaria.org</a>
                <span class="divider">·</span>
                <a href="https://github.com/Sefaria" target="_blank" rel="noopener">GitHub</a>
                <span class="divider">·</span>
                <a href="https://help.sefaria.org" target="_blank" rel="noopener">Help Center</a>
            </div>
            <p class="copyright">&copy; Sefaria</p>
        </footer>
    </div>

    <script>
        // Update "last checked" time every second
        (function () {
            const lastChecked = document.getElementById('last-checked');
            let seconds = 0;
            setInterval(function () {
                seconds += 1;
                if (seconds < 60) {
                    lastChecked.textContent = seconds + 's ago';
                } else {
                    const mins = Math.floor(seconds / 60);
                    lastChecked.textContent = mins + 'm ago';
                }
            }, 1000);
        })();
    </script>
</body>

</html>